import React, { useState, useEffect } from 'react';
import './styles/main.css';

const OmakaseApp = () => {
  const [currentPage, setCurrentPage] = useState('home');
  const [user, setUser] = useState(null);
  const [token, setToken] = useState(localStorage.getItem('token'));
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  const [loginData, setLoginData] = useState({ email: '', password: '' });
  const [registerData, setRegisterData] = useState({ username: '', email: '', password: '' });
  const [subscriptions, setSubscriptions] = useState([]);

  useEffect(() => {
    if (token) {
      try {
        const payload = JSON.parse(atob(token.split('.')[1]));
        setUser(payload);
        fetchSubscriptions();
      } catch (err) {
        console.error('Token error:', err);
        setToken(null);
      }
    }
  }, [token]);

  const apiCall = async (endpoint, method = 'GET', body = null) => {
    try {
      const headers = { 'Content-Type': 'application/json' };
      if (token) {
        headers.Authorization = `Bearer ${token}`;
      }

      const options = { method, headers };
      if (body) options.body = JSON.stringify(body);

      const response = await fetch(`http://localhost:5000${endpoint}`, options);

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || 'APIã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
      }

      return await response.json();
    } catch (err) {
      setError(err.message);
      console.error('APIã‚¨ãƒ©ãƒ¼:', err);
      throw err;
    }
  };

  const handleLogin = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError(null);
    try {
      const response = await apiCall('/api/users/login', 'POST', loginData);
      setToken(response.token);
      localStorage.setItem('token', response.token);
      setLoginData({ email: '', password: '' });
      setCurrentPage('home');
    } catch (err) {
      // ã‚¨ãƒ©ãƒ¼ã¯setErrorã§å‡¦ç†æ¸ˆã¿
    } finally {
      setLoading(false);
    }
  };

  const handleRegister = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError(null);
    try {
      await apiCall('/api/users/register', 'POST', registerData);
      setRegisterData({ username: '', email: '', password: '' });
      setCurrentPage('login');
      setError('ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚');
    } catch (err) {
      // ã‚¨ãƒ©ãƒ¼ã¯setErrorã§å‡¦ç†æ¸ˆã¿
    } finally {
      setLoading(false);
    }
  };

  const handleLogout = () => {
    setToken(null);
    setUser(null);
    localStorage.removeItem('token');
    setCurrentPage('home');
  };

  const fetchSubscriptions = async () => {
    try {
      const response = await fetch('http://localhost:5000/api/subscriptions', {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });
      if (response.ok) {
        const data = await response.json();
        setSubscriptions(data.subscriptions || []);
      }
    } catch (err) {
      console.error('ã‚µãƒ–ã‚¹ã‚¯å–å¾—ã‚¨ãƒ©ãƒ¼:', err);
    }
  };

  // ========== ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ==========
  if (!token) {
    if (currentPage === 'register') {
      return (
        <div style={styles.authContainer}>
          <div style={styles.authCard}>
            <h2>æ–°è¦ä¼šå“¡ç™»éŒ²</h2>
            {error && <div style={styles.errorAlert}>âš ï¸ {error}</div>}
            <form onSubmit={handleRegister}>
              <input
                type="text"
                placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å"
                value={registerData.username}
                onChange={(e) => setRegisterData({ ...registerData, username: e.target.value })}
                required
                style={styles.input}
              />
              <input
                type="email"
                placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"
                value={registerData.email}
                onChange={(e) => setRegisterData({ ...registerData, email: e.target.value })}
                required
                style={styles.input}
              />
              <input
                type="password"
                placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
                value={registerData.password}
                onChange={(e) => setRegisterData({ ...registerData, password: e.target.value })}
                required
                style={styles.input}
              />
              <button type="submit" disabled={loading} style={styles.button}>
                {loading ? 'â³ ç™»éŒ²ä¸­...' : 'ç™»éŒ²'}
              </button>
            </form>
            <p>
              æ—¢ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã§ã™ã‹ï¼Ÿ
              <button onClick={() => setCurrentPage('login')} style={styles.link}>ãƒ­ã‚°ã‚¤ãƒ³</button>
            </p>
          </div>
        </div>
      );
    }

    if (currentPage === 'login') {
      return (
        <div style={styles.authContainer}>
          <div style={styles.authCard}>
            <h2>ãƒ­ã‚°ã‚¤ãƒ³</h2>
            {error && <div style={styles.errorAlert}>âš ï¸ {error}</div>}
            <form onSubmit={handleLogin}>
              <input
                type="email"
                placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"
                value={loginData.email}
                onChange={(e) => setLoginData({ ...loginData, email: e.target.value })}
                required
                style={styles.input}
              />
              <input
                type="password"
                placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
                value={loginData.password}
                onChange={(e) => setLoginData({ ...loginData, password: e.target.value })}
                required
                style={styles.input}
              />
              <button type="submit" disabled={loading} style={styles.button}>
                {loading ? 'â³ ãƒ­ã‚°ã‚¤ãƒ³ä¸­...' : 'ãƒ­ã‚°ã‚¤ãƒ³'}
              </button>
            </form>
            <p>
              ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã§ãªã„æ–¹ï¼Ÿ
              <button onClick={() => setCurrentPage('register')} style={styles.link}>ç™»éŒ²</button>
            </p>
          </div>
        </div>
      );
    }

    return (
      <div style={styles.appContainer}>
        <header style={styles.header}>
          <h1>ğŸ ãŠã¾ã‹ã›å®šæœŸä¾¿</h1>
          <p>ã‚ãªãŸã®å¥½ã¿ã‚’åˆ†æã—ã¦ã€æ¯æœˆãŠã™ã™ã‚ã‚’ãŠå±Šã‘ã—ã¾ã™</p>
        </header>

        <main style={styles.main}>
          <section style={styles.features}>
            <div style={styles.featureCard}>
              <div style={styles.featureIcon}>â˜•</div>
              <h3>å¤šæ§˜ãªã‚«ãƒ†ã‚´ãƒª</h3>
              <p>ã‚³ãƒ¼ãƒ’ãƒ¼è±†ã€ç´…èŒ¶ã€ã‚¹ã‚¤ãƒ¼ãƒ„ã€æœ¬ã‹ã‚‰é¸æŠ</p>
            </div>
            <div style={styles.featureCard}>
              <div style={styles.featureIcon}>â­</div>
              <h3>AIè¨ºæ–­ã‚¯ã‚¤ã‚º</h3>
              <p>ã‚ãªãŸã®å¥½ã¿ã‚’è©³ç´°ã«åˆ†æã—ã€æœ€é©ãªå•†å“ã‚’ãŠã™ã™ã‚</p>
            </div>
            <div style={styles.featureCard}>
              <div style={styles.featureIcon}>ğŸ“…</div>
              <h3>å®šæœŸé…é€</h3>
              <p>æœˆ1å›ã€2é€±é–“ã«1å›ã€é€±1å›ã‹ã‚‰é¸ã¹ã‚‹é…é€é »åº¦</p>
            </div>
            <div style={styles.featureCard}>
              <div style={styles.featureIcon}>ğŸ“¦</div>
              <h3>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†</h3>
              <p>æ¬¡å›é…é€æ—¥ã‚’ã„ã¤ã§ã‚‚ç¢ºèªãƒ»ç®¡ç†ã§ãã¾ã™</p>
            </div>
          </section>

          <div style={styles.ctaButtons}>
            <button onClick={() => setCurrentPage('login')} style={styles.buttonPrimary}>ãƒ­ã‚°ã‚¤ãƒ³</button>
            <button onClick={() => setCurrentPage('register')} style={styles.buttonSecondary}>æ–°è¦ç™»éŒ²</button>
          </div>
        </main>
      </div>
    );
  }

  // ========== ãƒ­ã‚°ã‚¤ãƒ³å¾Œ ==========
  return (
    <div style={styles.appContainer}>
      <header style={{...styles.header, ...styles.dashboardHeader}}>
        <h1>ğŸ ãŠã¾ã‹ã›å®šæœŸä¾¿</h1>
        <div style={styles.headerNav}>
          <button onClick={() => setCurrentPage('home')} style={{...styles.navButton, ...(currentPage === 'home' ? styles.navButtonActive : {})}}>
            ğŸ 
          </button>
          <button onClick={() => setCurrentPage('subscriptions')} style={{...styles.navButton, ...(currentPage === 'subscriptions' ? styles.navButtonActive : {})}}>
            ğŸ“…
          </button>
          <button onClick={handleLogout} style={styles.navButton}>
            ğŸšª
          </button>
        </div>
      </header>

      {error && <div style={styles.errorAlert}>âš ï¸ {error}</div>}

      <main style={styles.main}>
        {currentPage === 'home' && (
          <div>
            <h2>ã‚ˆã†ã“ãï¼{user?.email || 'ãƒ¦ãƒ¼ã‚¶ãƒ¼'}</h2>

            {subscriptions.length === 0 ? (
              <div style={styles.emptyState}>
                <div style={{fontSize: '60px'}}>ğŸ“¦</div>
                <h3>ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</h3>
                <p>ã¾ãšã¯è¨ºæ–­ã‚¯ã‚¤ã‚ºã«å‚åŠ ã—ã¦ã€ã‚ãªãŸã®å¥½ã¿ã‚’æ•™ãˆã¦ãã ã•ã„ï¼</p>
              </div>
            ) : (
              <section>
                <h3>ã‚ãªãŸã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³</h3>
                {subscriptions.map((sub) => (
                  <div key={sub.id} style={styles.subscriptionCard}>
                    <h4>{sub.category_name}</h4>
                    <p>ãƒ—ãƒ©ãƒ³: {sub.plan}</p>
                    <p>æ¬¡å›é…é€: {new Date(sub.next_delivery_date).toLocaleDateString('ja-JP')}</p>
                    <p>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: {sub.status}</p>
                  </div>
                ))}
              </section>
            )}
          </div>
        )}

        {currentPage === 'subscriptions' && (
          <div>
            <h2>ğŸ“‹ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†</h2>
            {subscriptions.length === 0 ? (
              <div style={styles.emptyState}>
                <div style={{fontSize: '60px'}}>ğŸ“…</div>
                <h3>ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã›ã‚“</h3>
              </div>
            ) : (
              <div>
                {subscriptions.map((sub) => (
                  <div key={sub.id} style={styles.subscriptionDetail}>
                    <h3>{sub.category_name}</h3>
                    <p><strong>ãƒ—ãƒ©ãƒ³:</strong> {sub.plan}</p>
                    <p><strong>æ¬¡å›é…é€:</strong> {new Date(sub.next_delivery_date).toLocaleDateString('ja-JP')}</p>
                    <p><strong>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:</strong> {sub.status}</p>
                  </div>
                ))}
              </div>
            )}
          </div>
        )}
      </main>
    </div>
  );
};

const styles = {
  appContainer: {
    minHeight: '100vh',
    background: 'linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)',
    fontFamily: 'Segoe UI, Tahoma, Geneva, Verdana, sans-serif',
  },
  header: {
    background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
    color: 'white',
    padding: '40px 20px',
    textAlign: 'center',
    boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
  },
  dashboardHeader: {
    display: 'flex',
    justifyContent: 'space-between',
    alignItems: 'center',
  },
  headerNav: {
    display: 'flex',
    gap: '10px',
  },
  navButton: {
    fontSize: '24px',
    background: 'rgba(255,255,255,0.2)',
    border: 'none',
    padding: '8px 12px',
    borderRadius: '4px',
    cursor: 'pointer',
    transition: 'background 0.3s',
  },
  navButtonActive: {
    background: 'rgba(255,255,255,0.4)',
  },
  main: {
    maxWidth: '1000px',
    margin: '40px auto',
    padding: '0 20px',
  },
  features: {
    display: 'grid',
    gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))',
    gap: '20px',
    marginBottom: '40px',
  },
  featureCard: {
    background: 'white',
    padding: '30px',
    borderRadius: '8px',
    boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
    textAlign: 'center',
  },
  featureIcon: {
    fontSize: '40px',
    marginBottom: '10px',
  },
  ctaButtons: {
    display: 'flex',
    gap: '15px',
    justifyContent: 'center',
  },
  buttonPrimary: {
    background: '#667eea',
    color: 'white',
    padding: '12px 40px',
    border: 'none',
    borderRadius: '4px',
    cursor: 'pointer',
    fontSize: '16px',
    fontWeight: '500',
  },
  buttonSecondary: {
    background: 'white',
    color: '#667eea',
    padding: '12px 40px',
    border: '2px solid #667eea',
    borderRadius: '4px',
    cursor: 'pointer',
    fontSize: '16px',
    fontWeight: '500',
  },
  authContainer: {
    minHeight: '100vh',
    display: 'flex',
    justifyContent: 'center',
    alignItems: 'center',
    background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
  },
  authCard: {
    background: 'white',
    padding: '40px',
    borderRadius: '8px',
    boxShadow: '0 8px 32px rgba(0,0,0,0.2)',
    width: '100%',
    maxWidth: '400px',
  },
  input: {
    width: '100%',
    padding: '10px 15px',
    marginBottom: '15px',
    border: '1px solid #ddd',
    borderRadius: '4px',
    fontSize: '14px',
    boxSizing: 'border-box',
  },
  button: {
    width: '100%',
    padding: '10px 15px',
    background: '#667eea',
    color: 'white',
    border: 'none',
    borderRadius: '4px',
    cursor: 'pointer',
    fontSize: '14px',
    fontWeight: '500',
  },
  link: {
    background: 'none',
    border: 'none',
    color: '#667eea',
    cursor: 'pointer',
    marginLeft: '5px',
    textDecoration: 'underline',
  },
  errorAlert: {
    background: '#fee',
    border: '1px solid #fcc',
    padding: '15px 20px',
    borderRadius: '4px',
    color: '#c00',
    margin: '20px auto',
    maxWidth: '1000px',
  },
  emptyState: {
    textAlign: 'center',
    padding: '60px 20px',
  },
  subscriptionCard: {
    background: 'white',
    padding: '20px',
    borderRadius: '8px',
    marginBottom: '15px',
    boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
  },
  subscriptionDetail: {
    background: 'white',
    padding: '20px',
    borderRadius: '8px',
    marginBottom: '15px',
    boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
  },
};

export default OmakaseApp;
  // ============ State Management ============
  const [currentPage, setCurrentPage] = useState('home');
  const [user, setUser] = useState(null);
  const [token, setToken] = useState(localStorage.getItem('token'));
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãƒ•ã‚©ãƒ¼ãƒ 
  const [loginData, setLoginData] = useState({ email: '', password: '' });
  const [registerData, setRegisterData] = useState({ username: '', email: '', password: '' });

  // ã‚«ãƒ†ã‚´ãƒªé¸æŠ
  const [categories, setCategories] = useState([]);
  const [selectedCategory, setSelectedCategory] = useState(null);

  // è¨ºæ–­ã‚¯ã‚¤ã‚º
  const [currentQuestion, setCurrentQuestion] = useState(0);
  const [quizAnswers, setQuizAnswers] = useState({});
  const [diagnosticResult, setDiagnosticResult] = useState(null);

  // ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³
  const [subscriptions, setSubscriptions] = useState([]);
  const [selectedPlan, setSelectedPlan] = useState('basic');

  // æ¨å¥¨å•†å“
  const [recommendations, setRecommendations] = useState([]);

  // ============ ã‚«ãƒ†ã‚´ãƒªåˆ¥è¨ºæ–­ã‚¯ã‚¤ã‚ºå®šç¾© ============
  const getQuizByCategory = (categoryId) => {
    const quizzes = {
      1: [ // ã‚³ãƒ¼ãƒ’ãƒ¼è±†
        {
          id: 'roast',
          question: 'ã©ã®ç„™ç…åº¦ãŒãŠå¥½ã¿ã§ã™ã‹ï¼Ÿ',
          options: [
            { value: 'light', label: 'æµ…ç…ã‚Š', desc: 'ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼ã§é…¸å‘³ãŒç‰¹å¾´' },
            { value: 'medium', label: 'ä¸­ç…ã‚Š', desc: 'ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸå‘³ã‚ã„' },
            { value: 'dark', label: 'æ·±ç…ã‚Š', desc: 'æ¿ƒåšã§ã‚³ã‚¯ã®ã‚ã‚‹å‘³' }
          ]
        },
        {
          id: 'flavor',
          question: 'å¥½ããªé¢¨å‘³ã¯ï¼Ÿ',
          options: [
            { value: 'fruity', label: 'ãƒ•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ¼', desc: 'ãƒ™ãƒªãƒ¼ã‚„æŸ‘æ©˜ç³»ã®é¦™ã‚Š' },
            { value: 'nutty', label: 'ãƒŠãƒƒãƒ„ç³»', desc: 'ã‚¢ãƒ¼ãƒ¢ãƒ³ãƒ‰ã‚„ãƒ˜ãƒ¼ã‚¼ãƒ«ãƒŠãƒƒãƒ„' },
            { value: 'chocolate', label: 'ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ', desc: 'ã‚«ã‚«ã‚ªã‚„ã‚­ãƒ£ãƒ©ãƒ¡ãƒ«' }
          ]
        },
        {
          id: 'strength',
          question: 'ã‚³ãƒ¼ãƒ’ãƒ¼ã®æ¿ƒã•ã¯ï¼Ÿ',
          options: [
            { value: 'mild', label: 'ãƒã‚¤ãƒ«ãƒ‰', desc: 'å„ªã—ã„é£²ã¿å£' },
            { value: 'medium', label: 'æ™®é€š', desc: 'ã¡ã‚‡ã†ã©è‰¯ã„æ¿ƒã•' },
            { value: 'strong', label: 'æ¿ƒã„ã‚', desc: 'ã—ã£ã‹ã‚Šã¨ã—ãŸå‘³ã‚ã„' }
          ]
        },
        {
          id: 'frequency',
          question: '1ãƒ¶æœˆã§ã©ã®ãã‚‰ã„é£²ã¿ã¾ã™ã‹ï¼Ÿ',
          options: [
            { value: 'light', label: 'é€±2-3æ¯', desc: '200g/æœˆï¼ˆç´„10æ¯åˆ†ï¼‰' },
            { value: 'regular', label: 'æ¯æ—¥1æ¯', desc: '500g/æœˆï¼ˆç´„25æ¯åˆ†ï¼‰' },
            { value: 'heavy', label: 'æ¯æ—¥2-3æ¯', desc: '1kg/æœˆï¼ˆç´„50æ¯åˆ†ï¼‰' }
          ]
        }
      ],
      2: [ // é´ä¸‹
        {
          id: 'material',
          question: 'å¥½ã¿ã®ç´ æã¯ï¼Ÿ',
          options: [
            { value: 'cotton', label: 'ç¶¿', desc: 'é€šæ°—æ€§ãŒè‰¯ãçˆ½ã‚„ã‹' },
            { value: 'wool', label: 'ã‚¦ãƒ¼ãƒ«', desc: 'ä¿æ¸©æ€§ãŒé«˜ãæš–ã‹ã„' },
            { value: 'blend', label: 'ãƒ–ãƒ¬ãƒ³ãƒ‰', desc: 'ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸç´ æ' }
          ]
        },
        {
          id: 'season',
          question: 'ã©ã®å­£ç¯€ç”¨ã§ã™ã‹ï¼Ÿ',
          options: [
            { value: 'summer', label: 'å¤ç”¨', desc: 'è’¸ã‚Œã«ããå¿«é©' },
            { value: 'spring_fall', label: 'æ˜¥ãƒ»ç§‹ç”¨', desc: 'å®šç•ªãƒ»ã‚ªãƒ¼ãƒ«ã‚·ãƒ¼ã‚ºãƒ³' },
            { value: 'winter', label: 'å†¬ç”¨', desc: 'åšæ‰‹ãƒ»ä¿æ¸©æ€§é‡è¦–' }
          ]
        },
        {
          id: 'thickness',
          question: 'åšã•ã®å¥½ã¿ã¯ï¼Ÿ',
          options: [
            { value: 'thin', label: 'è–„æ‰‹', desc: 'ãƒ•ã‚£ãƒƒãƒˆæ„Ÿé‡è¦–' },
            { value: 'medium', label: 'ä¸­åš', desc: 'ãƒãƒ©ãƒ³ã‚¹å‹' },
            { value: 'thick', label: 'åšæ‰‹', desc: 'å±¥ãå¿ƒåœ°ãƒ»æ¸©ã‹ã•é‡è¦–' }
          ]
        }
      ],
      3: [ // ã‚¹ã‚­ãƒ³ã‚±ã‚¢
        {
          id: 'skinType',
          question: 'ã‚ãªãŸã®è‚Œã‚¿ã‚¤ãƒ—ã¯ï¼Ÿ',
          options: [
            { value: 'oily', label: 'ã‚ªã‚¤ãƒªãƒ¼è‚Œ', desc: 'çš®è„‚ãŒå¤šã‚ã€ãƒ†ã‚«ã‚Šã‚„ã™ã„' },
            { value: 'dry', label: 'ä¹¾ç‡¥è‚Œ', desc: 'ã¤ã£ã±ã‚Šæ„Ÿã€ç²‰å¹ããŒã‚ã‚‹' },
            { value: 'combination', label: 'ã‚³ãƒ³ãƒ“ãƒãƒ¼ã‚·ãƒ§ãƒ³è‚Œ', desc: 'Tã‚¾ãƒ¼ãƒ³ã¯è„‚ã£ã½ãã€é ¬ã¯ä¹¾ç‡¥' }
          ]
        },
        {
          id: 'concern',
          question: 'ä¸»ãªè‚Œã®æ‚©ã¿ã¯ï¼Ÿ',
          options: [
            { value: 'acne', label: 'ãƒ‹ã‚­ãƒ“ãƒ»è‚Œè’ã‚Œ', desc: 'å¹ãå‡ºç‰©ãŒå¤šã„' },
            { value: 'aging', label: 'ã‚¨ã‚¤ã‚¸ãƒ³ã‚°ã‚±ã‚¢', desc: 'ã‚·ãƒ¯ãƒ»ãŸã‚‹ã¿ãƒ»ãã™ã¿' },
            { value: 'sensitivity', label: 'æ•æ„Ÿè‚Œ', desc: 'ã‹ã‚†ã¿ãƒ»èµ¤ã¿ãƒ»åˆºæ¿€ã«å¼±ã„' }
          ]
        },
        {
          id: 'priority',
          question: 'ã‚¹ã‚­ãƒ³ã‚±ã‚¢ã§æœ€ã‚‚å„ªå…ˆã—ãŸã„ã“ã¨ã¯ï¼Ÿ',
          options: [
            { value: 'moisture', label: 'ä¿æ¹¿', desc: 'ã—ã£ã¨ã‚Šã—ãŸè‚Œã¸' },
            { value: 'cleanliness', label: 'æ¸…æ½”æ„Ÿ', desc: 'ã‚¯ãƒªã‚¢ã§é€æ˜æ„Ÿã®ã‚ã‚‹è‚Œ' },
            { value: 'whitening', label: 'ãƒ›ãƒ¯ã‚¤ãƒˆãƒ‹ãƒ³ã‚°', desc: 'ç¾ç™½ãƒ»é€æ˜åº¦UP' }
          ]
        }
      ]
    };

    return quizzes[categoryId] || quizzes[1];
  };

  // ============ APIã‚³ãƒ¼ãƒ«é–¢æ•° ============
  const apiCall = async (endpoint, method = 'GET', body = null) => {
    try {
      const headers = { 'Content-Type': 'application/json' };
      if (token) {
        headers.Authorization = `Bearer ${token}`;
      }

      const options = { method, headers };
      if (body) options.body = JSON.stringify(body);

      const response = await fetch(`http://localhost:5000${endpoint}`, options);

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || 'APIã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
      }

      return await response.json();
    } catch (err) {
      setError(err.message);
      console.error('APIã‚¨ãƒ©ãƒ¼:', err);
      throw err;
    }
  };

  // ============ åˆæœŸåŒ–ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼é–¢é€£ ============
  useEffect(() => {
    if (token) {
      // ãƒˆãƒ¼ã‚¯ãƒ³ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å–å¾—ï¼ˆJWTãƒ‡ã‚³ãƒ¼ãƒ‰ï¼‰
      const payload = JSON.parse(atob(token.split('.')[1]));
      setUser(payload);
    }
  }, [token]);

  const handleLogin = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError(null);
    try {
      const response = await apiCall('/api/users/login', 'POST', loginData);
      setToken(response.token);
      localStorage.setItem('token', response.token);
      setLoginData({ email: '', password: '' });
      setCurrentPage('home');
    } catch (err) {
      // ã‚¨ãƒ©ãƒ¼ã¯æ—¢ã«setErrorã§å‡¦ç†æ¸ˆã¿
    } finally {
      setLoading(false);
    }
  };

  const handleRegister = async (e) => {
    e.preventDefault();
    setLoading(true);
    setError(null);
    try {
      await apiCall('/api/users/register', 'POST', registerData);
      setRegisterData({ username: '', email: '', password: '' });
      setCurrentPage('login');
      setError('ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚');
    } catch (err) {
      // ã‚¨ãƒ©ãƒ¼ã¯æ—¢ã«setErrorã§å‡¦ç†æ¸ˆã¿
    } finally {
      setLoading(false);
    }
  };

  const handleLogout = () => {
    setToken(null);
    setUser(null);
    localStorage.removeItem('token');
    setCurrentPage('home');
  };

  // ============ ã‚«ãƒ†ã‚´ãƒªå–å¾— ============
  useEffect(() => {
    const fetchCategories = async () => {
      try {
        const data = await apiCall('/api/categories');
        setCategories(data);
      } catch (err) {
        console.error('ã‚«ãƒ†ã‚´ãƒªå–å¾—ã‚¨ãƒ©ãƒ¼:', err);
      }
    };
    fetchCategories();
  }, []);

  // ============ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³å–å¾— ============
  useEffect(() => {
    if (user) {
      const fetchSubscriptions = async () => {
        try {
          const data = await apiCall(`/api/subscriptions/${user.id}`);
          setSubscriptions(data);
        } catch (err) {
          console.error('ã‚µãƒ–ã‚¹ã‚¯å–å¾—ã‚¨ãƒ©ãƒ¼:', err);
        }
      };
      fetchSubscriptions();
    }
  }, [user]);

  // ============ è¨ºæ–­ã‚¯ã‚¤ã‚º ============
  const handleAnswerQuestion = (answer) => {
    const currentQ = getQuizByCategory(selectedCategory)[currentQuestion];
    setQuizAnswers({
      ...quizAnswers,
      [currentQ.id]: answer
    });

    if (currentQuestion < getQuizByCategory(selectedCategory).length - 1) {
      setCurrentQuestion(currentQuestion + 1);
    } else {
      // ã‚¯ã‚¤ã‚ºå®Œäº† â†’ è¨ºæ–­çµæœç”Ÿæˆ
      generateDiagnosticResult();
    }
  };

  const generateDiagnosticResult = async () => {
    try {
      const preferences = Object.assign({}, quizAnswers);
      const score = Object.keys(quizAnswers).length * 25; // ç°¡æ˜“ã‚¹ã‚³ã‚¢

      await apiCall('/api/diagnostic-results', 'POST', {
        categoryId: selectedCategory,
        answers: quizAnswers,
        preferences,
        score
      });

      // æ¨å¥¨å•†å“ã‚’ç”Ÿæˆ
      await apiCall(`/api/recommendations/${user.id}/generate`, 'POST', {
        categoryId: selectedCategory
      });

      // æ¨å¥¨å•†å“ã‚’å–å¾—
      const recs = await apiCall(`/api/recommendations/${user.id}`);
      setRecommendations(recs);

      setDiagnosticResult({
        preferences,
        score,
        timestamp: new Date().toLocaleDateString('ja-JP')
      });

      setCurrentQuestion(0);
      setQuizAnswers({});
    } catch (err) {
      console.error('è¨ºæ–­ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', err);
    }
  };

  // ============ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ä½œæˆ ============
  const handleCreateSubscription = async () => {
    try {
      const frequencyMap = { basic: 30, premium: 14, deluxe: 7 };
      
      await apiCall('/api/subscriptions', 'POST', {
        categoryId: selectedCategory,
        plan: selectedPlan,
        frequency: frequencyMap[selectedPlan]
      });

      // ã‚µãƒ–ã‚¹ã‚¯å†å–å¾—
      const updated = await apiCall(`/api/subscriptions/${user.id}`);
      setSubscriptions(updated);

      setCurrentPage('subscriptions');
      setError('');
    } catch (err) {
      console.error('ã‚µãƒ–ã‚¹ã‚¯ä½œæˆã‚¨ãƒ©ãƒ¼:', err);
    }
  };

  // ============ æ¬¡å›é…é€æ—¥è¨ˆç®— ============
  const calculateNextDelivery = (subscription) => {
    const nextDate = new Date(subscription.next_delivery_date);
    const today = new Date();
    const daysUntil = Math.ceil((nextDate - today) / (1000 * 60 * 60 * 24));
    return daysUntil > 0 ? `${daysUntil}æ—¥å¾Œ` : 'æœ¬æ—¥ãƒ»æ˜æ—¥';
  };

  // ============ UI Components ============
  const ErrorAlert = () =>
    error && (
      <div className="error-alert">
        âš ï¸
        <span>{error}</span>
        <button onClick={() => setError(null)}>âœ•</button>
      </div>
    );

  // ============ ãƒšãƒ¼ã‚¸ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ============
  if (!token) {
    // ãƒ­ã‚°ã‚¤ãƒ³å‰ç”»é¢
    if (currentPage === 'register') {
      return (
        <div className="auth-container">
          <div className="auth-card">
            <h2>æ–°è¦ä¼šå“¡ç™»éŒ²</h2>
            <ErrorAlert />
            <form onSubmit={handleRegister}>
              <input
                type="text"
                placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å"
                value={registerData.username}
                onChange={(e) => setRegisterData({ ...registerData, username: e.target.value })}
                required
              />
              <input
                type="email"
                placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"
                value={registerData.email}
                onChange={(e) => setRegisterData({ ...registerData, email: e.target.value })}
                required
              />
              <input
                type="password"
                placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
                value={registerData.password}
                onChange={(e) => setRegisterData({ ...registerData, password: e.target.value })}
                required
              />
              <button type="submit" disabled={loading}>
                {loading ? â³ : 'ç™»éŒ²'}
              </button>
            </form>
            <p className="auth-switch">
              æ—¢ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã§ã™ã‹ï¼Ÿ
              <button onClick={() => setCurrentPage('login')} className="link-button">ãƒ­ã‚°ã‚¤ãƒ³</button>
            </p>
          </div>
        </div>
      );
    }

    if (currentPage === 'login') {
      return (
        <div className="auth-container">
          <div className="auth-card">
            <h2>ãƒ­ã‚°ã‚¤ãƒ³</h2>
            <ErrorAlert />
            <form onSubmit={handleLogin}>
              <input
                type="email"
                placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"
                value={loginData.email}
                onChange={(e) => setLoginData({ ...loginData, email: e.target.value })}
                required
              />
              <input
                type="password"
                placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
                value={loginData.password}
                onChange={(e) => setLoginData({ ...loginData, password: e.target.value })}
                required
              />
              <button type="submit" disabled={loading}>
                {loading ? â³ : 'ãƒ­ã‚°ã‚¤ãƒ³'}
              </button>
            </form>
            <p className="auth-switch">
              ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã§ãªã„æ–¹ï¼Ÿ
              <button onClick={() => setCurrentPage('register')} className="link-button">ç™»éŒ²</button>
            </p>
          </div>
        </div>
      );
    }

    // ãƒ›ãƒ¼ãƒ ç”»é¢ï¼ˆæœªãƒ­ã‚°ã‚¤ãƒ³ï¼‰
    return (
      <div className="app-container">
        <header className="app-header">
          <h1>ğŸ ãŠã¾ã‹ã›å®šæœŸä¾¿</h1>
          <p>ã‚ãªãŸã®å¥½ã¿ã‚’åˆ†æã—ã¦ã€æ¯æœˆãŠã™ã™ã‚ã‚’ãŠå±Šã‘ã—ã¾ã™</p>
        </header>

        <ErrorAlert />

        <main className="app-main">
          <section className="features">
            <div className="feature-card">
               â˜• 
              <h3>å¤šæ§˜ãªã‚«ãƒ†ã‚´ãƒª</h3>
              <p>ã‚³ãƒ¼ãƒ’ãƒ¼è±†ã€é´ä¸‹ã€ã‚¹ã‚­ãƒ³ã‚±ã‚¢ã€ç´…èŒ¶ã€ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã‹ã‚‰é¸æŠ</p>
            </div>
            <div className="feature-card">
               â­ 
              <h3>AIè¨ºæ–­ã‚¯ã‚¤ã‚º</h3>
              <p>ã‚ãªãŸã®å¥½ã¿ã‚’è©³ç´°ã«åˆ†æã—ã€æœ€é©ãªå•†å“ã‚’ãŠã™ã™ã‚</p>
            </div>
            <div className="feature-card">
               ğŸ“… 
              <h3>å®šæœŸé…é€</h3>
              <p>æœˆ1å›ã€2é€±é–“ã«1å›ã€é€±1å›ã‹ã‚‰é¸ã¹ã‚‹é…é€é »åº¦</p>
            </div>
            <div className="feature-card">
               ğŸ“¦ 
              <h3>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†</h3>
              <p>æ¬¡å›é…é€æ—¥ã‚’ã„ã¤ã§ã‚‚ç¢ºèªãƒ»ç®¡ç†ã§ãã¾ã™</p>
            </div>
          </section>

          <div className="cta-buttons">
            <button className="btn btn-primary" onClick={() => setCurrentPage('login')}>ãƒ­ã‚°ã‚¤ãƒ³</button>
            <button className="btn btn-secondary" onClick={() => setCurrentPage('register')}>æ–°è¦ç™»éŒ²</button>
          </div>
        </main>
      </div>
    );
  }

  // ============ ãƒ­ã‚°ã‚¤ãƒ³å¾Œç”»é¢ ============
  return (
    <div className="app-container">
      <header className="app-header dashboard">
        <div className="header-top">
          <h1>ğŸ ãŠã¾ã‹ã›å®šæœŸä¾¿</h1>
          <div className="header-nav">
            <button onClick={() => setCurrentPage('home')} className={`nav-btn ${currentPage === 'home' ? 'active' : ''}`}>
              ğŸ 
            </button>
            <button onClick={() => setCurrentPage('subscriptions')} className={`nav-btn ${currentPage === 'subscriptions' ? 'active' : ''}`}>
              ğŸ“…
            </button>
            <button onClick={() => setCurrentPage('profile')} className={`nav-btn ${currentPage === 'profile' ? 'active' : ''}`}>
              âš™ï¸
            </button>
            <button onClick={handleLogout} className="nav-btn logout">
              ğŸšª
            </button>
          </div>
        </div>
      </header>

      <ErrorAlert />

      <main className="app-main">
        {/* ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ */}
        {currentPage === 'home' && (
          <div className="page-home">
            <h2>ã‚ˆã†ã“ãï¼{user?.email || 'ãƒ¦ãƒ¼ã‚¶ãƒ¼'}</h2>

            {subscriptions.length === 0 ? (
              <section className="empty-state">
                ğŸ“¦
                <h3>ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</h3>
                <p>ã¾ãšã¯è¨ºæ–­ã‚¯ã‚¤ã‚ºã«å‚åŠ ã—ã¦ã€ã‚ãªãŸã®å¥½ã¿ã‚’æ•™ãˆã¦ãã ã•ã„ï¼</p>
              </section>
            ) : (
              <section className="subscriptions-preview">
                <h3>ã‚ãªãŸã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³</h3>
                {subscriptions.map((sub) => (
                  <div key={sub.id} className="subscription-card">
                    <div className="card-header">
                      <h4>{sub.category_name}</h4>
                      <span className={`badge badge-${sub.plan}`}>{sub.plan}</span>
                    </div>
                    <p className="next-delivery">
                      <Calendar size={18} />
                      æ¬¡å›é…é€: {calculateNextDelivery(sub)}
                    </p>
                    <p className="delivery-date">{sub.next_delivery_date}</p>
                  </div>
                ))}
              </section>
            )}

            <section className="categories-section">
              <h3>ã‚«ãƒ†ã‚´ãƒªã‚’é¸ã‚“ã§è¨ºæ–­ã™ã‚‹</h3>
              <div className="categories-grid">
                {categories.map((cat) => {
                  const isSubscribed = subscriptions.some(s => s.category_id === cat.id);
                  return (
                    <div
                      key={cat.id}
                      className={`category-card ${isSubscribed ? 'subscribed' : ''}`}
                      onClick={() => {
                        setSelectedCategory(cat.id);
                        setCurrentQuestion(0);
                        setQuizAnswers({});
                        setDiagnosticResult(null);
                        setCurrentPage('quiz');
                      }}
                    >
                      <div className="cat-icon">{cat.icon === 'coffee' && 'â˜•'}{cat.icon === 'socks' && 'ğŸ§¦'}{cat.icon === 'skincare' && 'ğŸ’„'}{cat.icon === 'tea' && 'ğŸµ'}{cat.icon === 'chocolate' && 'ğŸ«'}</div>
                      <h4>{cat.name}</h4>
                      <p>{cat.description}</p>
                      {isSubscribed && <div className="subscribed-badge">> âœ“/> ç™»éŒ²æ¸ˆã¿</div>}
                      â†’
                    </div>
                  );
                })}
              </div>
            </section>
          </div>
        )}

        {/* è¨ºæ–­ã‚¯ã‚¤ã‚ºãƒšãƒ¼ã‚¸ */}
        {currentPage === 'quiz' && selectedCategory && (
          <div className="page-quiz">
            <div className="quiz-header">
              <h2>{categories.find(c => c.id === selectedCategory)?.name} è¨ºæ–­ã‚¯ã‚¤ã‚º</h2>
              <div className="progress-bar">
                <div className="progress" style={{ width: `${((currentQuestion + 1) / getQuizByCategory(selectedCategory).length) * 100}%` }}></div>
              </div>
              <p className="progress-text">{currentQuestion + 1} / {getQuizByCategory(selectedCategory).length}</p>
            </div>

            {!diagnosticResult ? (
              <div className="quiz-content">
                <div className="question">
                  <h3>{getQuizByCategory(selectedCategory)[currentQuestion].question}</h3>
                  <div className="options">
                    {getQuizByCategory(selectedCategory)[currentQuestion].options.map((option) => (
                      <button
                        key={option.value}
                        className={`option-button ${quizAnswers[getQuizByCategory(selectedCategory)[currentQuestion].id] === option.value ? 'selected' : ''}`}
                        onClick={() => handleAnswerQuestion(option.value)}
                      >
                        <div className="option-label">{option.label}</div>
                        <div className="option-desc">{option.desc}</div>
                      </button>
                    ))}
                  </div>
                </div>
              </div>
            ) : (
              <div className="quiz-result">
                <div className="result-card">
                  <h3>âœ¨ è¨ºæ–­å®Œäº†ï¼</h3>
                  <p className="result-score">ã‚ãªãŸã®ãƒãƒƒãƒã‚¹ã‚³ã‚¢: {diagnosticResult.score}%</p>

                  <div className="preferences-summary">
                    <h4>ã‚ãªãŸã®å¥½ã¿:</h4>
                    <div className="prefs-list">
                      {Object.entries(diagnosticResult.preferences).map(([key, value]) => (
                        <div key={key} className="pref-item">
                          <strong>{key}:</strong> {value}
                        </div>
                      ))}
                    </div>
                  </div>

                  {recommendations.length > 0 && (
                    <div className="recommendations-preview">
                      <h4>ãŠã™ã™ã‚å•†å“ãƒˆãƒƒãƒ—3</h4>
                      {recommendations.slice(0, 3).map((rec) => (
                        <div key={rec.id} className="rec-item">
                          â­
                          <span>{rec.product_name}</span>
                          <span className="price">Â¥{rec.price?.toLocaleString()}</span>
                        </div>
                      ))}
                    </div>
                  )}

                  <div className="result-actions">
                    <h4>æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—</h4>
                    <p>æ–™é‡‘ãƒ—ãƒ©ãƒ³ã‚’é¸ã‚“ã§ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ï¼</p>

                    <div className="plan-options">
                      {[
                        { id: 'basic', name: 'ãƒ™ãƒ¼ã‚·ãƒƒã‚¯', price: 1980, frequency: 'æœˆ1å›', desc: 'æ¯æœˆç¬¬1é€±' },
                        { id: 'premium', name: 'ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ', price: 3480, frequency: '2é€±é–“ã«1å›', desc: 'éš”é€±é…é€' },
                        { id: 'deluxe', name: 'ãƒ‡ãƒ©ãƒƒã‚¯ã‚¹', price: 5980, frequency: 'é€±1å›', desc: 'æ¯é€±é…é€' }
                      ].map((plan) => (
                        <div
                          key={plan.id}
                          className={`plan-card ${selectedPlan === plan.id ? 'selected' : ''}`}
                          onClick={() => setSelectedPlan(plan.id)}
                        >
                          <h5>{plan.name}</h5>
                          <div className="plan-price">Â¥{plan.price.toLocaleString()}</div>
                          <div className="plan-freq">{plan.frequency}</div>
                          <p className="plan-desc">{plan.desc}</p>
                        </div>
                      ))}
                    </div>

                    <button className="btn btn-primary btn-large" onClick={handleCreateSubscription}>
                      {selectedPlan === 'basic' && 'Â¥1,980ã§'}
                      {selectedPlan === 'premium' && 'Â¥3,480ã§'}
                      {selectedPlan === 'deluxe' && 'Â¥5,980ã§'}
                      ã‚µãƒ–ã‚¹ã‚¯ã‚’å§‹ã‚ã‚‹
                    </button>
                  </div>
                </div>
              </div>
            )}

            <button className="btn btn-secondary" onClick={() => setCurrentPage('home')}>
              â† æˆ»ã‚‹
            </button>
          </div>
        )}

        {/* ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†ãƒšãƒ¼ã‚¸ */}
        {currentPage === 'subscriptions' && (
          <div className="page-subscriptions">
            <h2>ğŸ“‹ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†</h2>

            {subscriptions.length === 0 ? (
              <div className="empty-state">
                <Calendar size={60} />
                <h3>ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã›ã‚“</h3>
                <button className="btn btn-primary" onClick={() => setCurrentPage('home')}>
                  ã‚«ãƒ†ã‚´ãƒªã‚’æ¢ã™
                </button>
              </div>
            ) : (
              <div className="subscriptions-list">
                {subscriptions.map((sub) => (
                  <div key={sub.id} className="subscription-detail">
                    <div className="sub-header">
                      <div className="sub-info">
                        <h3>{sub.category_name}</h3>
                        <span className={`status-badge status-${sub.status}`}>{sub.status}</span>
                      </div>
                      <div className="plan-badge">{sub.plan}</div>
                    </div>

                    <div className="sub-details">
                      <div className="detail-item">
                        <strong>æ¬¡å›é…é€æ—¥:</strong>
                        <span className="next-date">{new Date(sub.next_delivery_date).toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
                        <span className="days-until">({calculateNextDelivery(sub)})</span>
                      </div>
                      <div className="detail-item">
                        <strong>é…é€é–“éš”:</strong>
                        <span>{sub.frequency}æ—¥ã”ã¨</span>
                      </div>
                      <div className="detail-item">
                        <strong>ç™»éŒ²æ—¥:</strong>
                        <span>{new Date(sub.created_at).toLocaleDateString('ja-JP')}</span>
                      </div>
                    </div>

                    <div className="sub-actions">
                      <button className="btn btn-small">é…é€å±¥æ­´ã‚’è¡¨ç¤º</button>
                      <button className="btn btn-small btn-outline">è©³ç´°è¨­å®š</button>
                      {sub.status === 'active' && (
                        <button className="btn btn-small btn-danger">ä¸€æ™‚åœæ­¢</button>
                      )}
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        )}

        {/* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ */}
        {currentPage === 'profile' && (
          <div className="page-profile">
            <h2>âš™ï¸ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®š</h2>
            <div className="profile-card">
              <div className="profile-info">
                <p><strong>ãƒ¡ãƒ¼ãƒ«:</strong> {user?.email}</p>
                <p><strong>ä¼šå“¡ID:</strong> {user?.id}</p>
              </div>
              <button className="btn btn-danger" onClick={handleLogout}>
                <LogOut size={18} /> ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
              </button>
            </div>
          </div>
        )}
      </main>
    </div>
  );
};

export default OmakaseApp;
